# Dockerfile for Frontend Static Site
# This builds the frontend and serves it with nginx

FROM node:20-slim AS base

# Build args for environment variables
ARG VITE_API_URL
ARG VITE_CLERK_PUBLISHABLE_KEY

WORKDIR /app

# Copy root package files
COPY package.json bun.lock* ./
COPY tsconfig.base.json tsconfig.json nx.json ./

# Copy frontend source and shared-types
COPY apps/frontend ./apps/frontend
COPY packages/shared-types ./packages/shared-types

# Install dependencies
RUN npm install

# Build frontend with environment variables
WORKDIR /app/apps/frontend
ENV VITE_API_URL=$VITE_API_URL
ENV VITE_CLERK_PUBLISHABLE_KEY=$VITE_CLERK_PUBLISHABLE_KEY
RUN npm run build

# Production stage with nginx
FROM nginx:alpine

# Copy built frontend
COPY --from=base /app/dist/apps/frontend /usr/share/nginx/html

# Copy static-only nginx configuration (no backend proxy)
COPY apps/frontend/nginx.static.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]

